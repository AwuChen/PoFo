<!DOCTYPE html>
<html lang="en">
<head> 
  <style> 
    body { margin: 0; overflow: hidden; }
    canvas { display: block; position: absolute; top: 0; left: 0; z-index: 0; }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255,255,255,0.95);
      padding: 10px;
      border-radius: 8px;
      font-family: sans-serif;
      max-height: 90vh;
      overflow: auto;
    }
    .section-title { font-weight: bold; margin-top: 10px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/force-graph"></script>
</head>

<body>
  <div id="controls">
    <div class="section-title">PORTFOLIO & CATEGORIES</div>
    <label><input type="checkbox" class="filter-category" value="Investment"> Investment</label><br>
    <label><input type="checkbox" class="filter-category" value="Forces"> Forces</label><br>
    <label><input type="checkbox" class="filter-category" value="Consultancies"> Consultancies</label><br>
    <label><input type="checkbox" class="filter-category" value="Cities.culture.art"> Cities.culture.art</label><br>
    <label><input type="checkbox" class="filter-category" value="Ecosystems"> Ecosystems</label><br>
    <label><input type="checkbox" class="filter-category" value="Yesteryears"> Yesteryears</label><br>

    <div class="section-title">APPROACH & IMPACT</div>
    <label><input type="checkbox" class="filter-impact" value="Strategy.Culture"> Strategy.Culture</label><br>
    <label><input type="checkbox" class="filter-impact" value="Branding"> Branding</label><br>
    <label><input type="checkbox" class="filter-impact" value="Retail"> Retail</label><br>
    <label><input type="checkbox" class="filter-impact" value="East.West"> East.West</label><br>
    <label><input type="checkbox" class="filter-impact" value="Edu.Learning.Collective"> Edu.Learning.Collective</label><br>
    <label><input type="checkbox" class="filter-impact" value="Creative Solution"> Creative Solution</label><br>
  </div>

  <div id="graph"></div>

  <script>
    const baseRadius = 100;
    const ringSpacing = 80;
    const maxLayers = 6;

    const impactToRing = {
      "Strategy.Culture": 1,
      "Branding": 2,
      "Retail": 3,
      "East.West": 4,
      "Edu.Learning.Collective": 5,
      "Creative Solution": 6
    };

    const ringColors = ['#bc6c25', '#606c38', '#283618', '#dda15e', '#7b7b7b'];

    const radialLines = [
      { name: "URF / TX The BOX", categories: ["Investment"], impacts: ["Retail"] },
      { name: "SAUVEREIGN", categories: ["Consultancies"], impacts: ["Branding", "Retail"] },
      { name: "DONGHAI", categories: ["Ecosystems"], impacts: ["East.West", "Strategy.Culture"] },
      { name: "EASTERN SEAS", categories: ["Yesteryears"], impacts: ["Strategy.Culture"] },
      { name: "DANDELION", categories: ["Cities.culture.art"], impacts: ["Edu.Learning.Collective"] },
      { name: "BILI Q", categories: ["Forces"], impacts: ["Creative Solution", "Strategy.Culture"] },
      { name: "KYOTO ART BANK", categories: ["Cities.culture.art"], impacts: ["Edu.Learning.Collective", "East.West"] },
      { name: "ARAMIS WINES", categories: ["Investment", "Yesteryears"], impacts: ["Branding", "East.West"] }
    ];

    const nodes = [];
    const links = [];
    let nodeId = 0;

    const centerNodeId = nodeId++;
    nodes.push({
      id: centerNodeId,
      fx: 0,
      fy: 0,
      size: 6,
      color: '#000000'
    });

    radialLines.forEach((line, i) => {
      const angle = (2 * Math.PI * i) / radialLines.length;
      const radialIndex = i;
      let lastNodeId = centerNodeId;

      line.impacts.forEach((impact, j) => {
        const layer = impactToRing[impact] - 1;
        const radius = baseRadius + layer * ringSpacing;
        const x = radius * Math.cos(angle);
        const y = radius * Math.sin(angle);

        const thisNodeId = nodeId++;
        nodes.push({
          id: thisNodeId,
          fx: x,
          fy: y,
          radialIndex,
          name: line.name,
          categories: line.categories,
          impacts: line.impacts,
          impact,
          size: 5,
          color: ringColors[layer % ringColors.length]
        });

        links.push({
          source: lastNodeId,
          target: thisNodeId,
          radialIndex
        });

        lastNodeId = thisNodeId;
      });
    });

    const gData = { nodes, links };

    const Graph = ForceGraph()(document.getElementById('graph'))
    .graphData(gData)
    .enableNodeDrag(false)
    .onEngineTick(() => Graph.pauseAnimation())
    .linkWidth(() => 2)
    .linkColor(() => '#aaa')
    .nodeCanvasObject((node, ctx, globalScale) => {
      if (node.id === centerNodeId) {
          // Draw rings
        ctx.save();
        ctx.strokeStyle = '#ddd';
        ctx.lineWidth = 1 / globalScale;
        for (let i = 0; i < maxLayers; i++) {
          ctx.beginPath();
          ctx.arc(0, 0, baseRadius + i * ringSpacing, 0, 2 * Math.PI);
          ctx.stroke();
        }
        ctx.restore();
        return;
      }

      const label = node.name || '';
      ctx.beginPath();
      ctx.arc(node.x, node.y, node.size, 0, 2 * Math.PI);
      ctx.fillStyle = node.color;
      ctx.fill();

      ctx.font = `${12 / globalScale}px Sans-Serif`;
      ctx.textAlign = 'center';
      ctx.fillStyle = '#000';
      ctx.fillText(label, node.x, node.y - 8);
    });

    function getCheckedFilters(className) {
      return Array.from(document.querySelectorAll(`.filter-${className}:checked`)).map(cb => cb.value);
    }

    function applyFilters() {
      const selectedCategories = getCheckedFilters('category');
      const selectedImpacts = getCheckedFilters('impact');

      const radialToInclude = new Set();

      nodes.forEach(n => {
        if (!n.name) return;
        const catMatch = selectedCategories.length === 0 || selectedCategories.some(cat => n.categories.includes(cat));
        const impMatch = selectedImpacts.length === 0 || selectedImpacts.includes(n.impact);
        if (catMatch && impMatch) {
          radialToInclude.add(n.radialIndex);
        }
      });

      const filteredNodes = nodes.filter(n =>
        n.id === centerNodeId || (n.radialIndex !== undefined && radialToInclude.has(n.radialIndex))
        );

      const nodeMap = new Map(filteredNodes.map(n => [n.id, n]));

      const filteredLinks = links
      .filter(link => nodeMap.has(link.source) && nodeMap.has(link.target))
      .map(link => ({
        source: nodeMap.get(link.source),
        target: nodeMap.get(link.target),
        radialIndex: link.radialIndex
      }));

      Graph.graphData({ nodes: filteredNodes, links: filteredLinks });
    }

    document.querySelectorAll('.filter-category, .filter-impact').forEach(cb =>
      cb.addEventListener('change', applyFilters)
      );
    </script>
  </body>
  </html>
