<!DOCTYPE html>
<html lang="en">
<head>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; position: absolute; top: 0; left: 0; z-index: 0; }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255,255,255,0.95);
      padding: 10px;
      border-radius: 8px;
      font-family: sans-serif;
      max-height: 90vh;
      overflow-y: auto;
    }
    #controls h3 {
      margin-top: 10px;
      margin-bottom: 5px;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/force-graph"></script>
</head>
<body>
  <div id="controls">
    <h3>PORTFOLIO & CATEGORIES</h3>
    <div id="categoryFilters"></div>
    <h3>APPROACH & IMPACT</h3>
    <div id="impactFilters"></div>
  </div>
  <div id="graph"></div>

  <script>
    const entities = [
      { name: 'URF / TX The BOX', categories: ['Investment'], impacts: ['Retail'] },
      { name: 'SAUVEREIGN', categories: ['Investment'], impacts: ['Branding', 'Retail'] },
      { name: 'DONGHAI', categories: ['Investment'], impacts: ['East.West', 'Strategy.Culture'] },
      { name: 'EASTERN SEAS', categories: ['Investment'], impacts: ['Creative Solution'] },
      { name: 'DANDELION', categories: ['Investment'], impacts: ['Strategy.Culture', 'Edu.Learning.Collective'] },
      { name: 'BILI Q', categories: ['Investment'], impacts: ['East.West'] },
      { name: 'KYOTO ART BANK', categories: ['Investment'], impacts: ['Culture', 'Creative Solution'] },
      { name: 'ARAMIS WINES', categories: ['Investment'], impacts: ['Branding'] },
      { name: 'SEIICHI MIZUNO', categories: ['Forces'], impacts: ['Retail'] },
      { name: 'MARIO TESTINO', categories: ['Forces'], impacts: ['Branding', 'Retail'] },
      { name: 'JUDY DOBIAS', categories: ['Forces'], impacts: ['East.West', 'Strategy.Culture'] },
      { name: 'THE CROSSES', categories: ['Forces'], impacts: ['Creative Solution'] },
      { name: 'SUNTCHI', categories: ['Forces'], impacts: ['Strategy.Culture', 'Edu.Learning.Collective'] },
      { name: 'SHANGHAI INDUSTRIAL MUSEUM', categories: ['Consultancies'], impacts: ['East.West'] },
      { name: 'HONG KONG JOCKEY CLUB', categories: ['Consultancies'], impacts: ['Culture', 'Creative Solution'] },
      { name: 'MOLESKINE', categories: ['Consultancies'], impacts: ['Branding'] },
      { name: 'LUXEMBOURG IN CHINA', categories: ['Cities.culture.art'], impacts: ['Retail'] },
      { name: 'TONGJI UNIVERSITY', categories: ['Cities.culture.art'], impacts: ['Branding', 'Retail'] },
      { name: 'UNIVERSITY COLLABORATIONS', categories: ['Cities.culture.art'], impacts: ['East.West', 'Strategy.Culture'] },
      { name: 'CONFUCIUS SECONDARY SCHOOL', categories: ['Cities.culture.art'], impacts: ['Creative Solution'] },
      { name: 'DANISH DESIGN AWARD', categories: ['Cities.culture.art'], impacts: ['Strategy.Culture', 'Edu.Learning.Collective'] },
      { name: 'WORLD DESIGN CAPITAL', categories: ['Cities.culture.art'], impacts: ['East.West'] },
      { name: 'BANGKOK INTL DESIGN EXPO', categories: ['Cities.culture.art'], impacts: ['Culture', 'Creative Solution'] },
      { name: 'PENANG INSTITUTE', categories: ['Cities.culture.art'], impacts: ['Branding'] },
      { name: 'YUAN MUSEUM', categories: ['Cities.culture.art'], impacts: ['East.West'] },
      { name: 'PALACE MUSEUM', categories: ['Cities.culture.art'], impacts: ['Culture', 'Creative Solution'] },
      { name: 'ZENG FANZHI', categories: ['Cities.culture.art'], impacts: ['Branding'] },
      { name: 'TED / TEDX', categories: ['Ecosystems'], impacts: ['East.West'] },
      { name: 'BURNING MAN', categories: ['Ecosystems'], impacts: ['Culture', 'Creative Solution'] },
      { name: 'PAN ASIA NETWORK', categories: ['Ecosystems'], impacts: ['Branding'] },
      { name: 'SHANGHAI INDUSTRIAL MUSEUM', categories: ['Ecosystems'], impacts: ['East.West'] },
      { name: 'EARTH ONE', categories: ['Ecosystems'], impacts: ['Culture', 'Creative Solution'] },
      { name: 'ALTER PROJECTS', categories: ['Ecosystems'], impacts: ['Branding'] },
      { name: 'ASIA-EUROPE BRIDGE', categories: ['Ecosystems'], impacts: ['Branding'] },
      { name: 'BLOOMINGDALES NEW YORK', categories: ['Yesteryears'], impacts: ['Branding'] },
      { name: 'THE NEW YORK TIMES', categories: ['Yesteryears'], impacts: ['Branding'] },
      { name: 'URBAN ARCH BI-CITY BIENNALE', categories: ['Yesteryears'], impacts: ['Branding'] },
      { name: 'ISETAN', categories: ['Yesteryears'], impacts: ['Branding'] },
      { name: 'BENETTON', categories: ['Yesteryears'], impacts: ['Branding'] },
      { name: 'SOTHEBYS AUCTION HOUSE, INTL REALTY', categories: ['Yesteryears'], impacts: ['Branding'] }
    ];

    const impactRingMap = {
      'Strategy.Culture': 0,
      'Branding': 1,
      'Retail': 2,
      'East.West': 3,
      'Edu.Learning.Collective': 4,
      'Creative Solution': 5
    };

    const ringSpacing = 80;
    const baseRadius = 100;
    const ringColors = ['#bc6c25', '#606c38', '#283618', '#dda15e', '#7b7b7b', '#8ecae6'];
    const maxLayers = 6;

    let nodeId = 0;
    const nodes = [], links = [];

    const centerNodeId = nodeId++;
    nodes.push({ id: centerNodeId, fx: 0, fy: 0, size: 4, color: '#000000' });

    entities.forEach((entity, index) => {
      const angle = (2 * Math.PI * index) / entities.length;
      let lastNodeId = centerNodeId;

      entity.impacts.forEach(impact => {
        const ringIndex = impactRingMap[impact] ?? 0;
        const radius = baseRadius + ringIndex * ringSpacing;
        const x = radius * Math.cos(angle);
        const y = radius * Math.sin(angle);

        const thisNodeId = nodeId++;
        nodes.push({
          id: thisNodeId,
          fx: x,
          fy: y,
          name: entity.name,
          categories: entity.categories,
          impact: impact,
          radialIndex: index,
          size: 6,
          color: ringColors[ringIndex % ringColors.length]
        });

        links.push({
          source: lastNodeId,
          target: thisNodeId,
          radialIndex: index
        });

        lastNodeId = thisNodeId;
      });

// Add invisible tip node
const tipRadius = baseRadius + (maxLayers) * ringSpacing + 10; // Extend slightly past outermost ring
const tipX = tipRadius * Math.cos(angle);
const tipY = tipRadius * Math.sin(angle);
const tipNodeId = nodeId++;
nodes.push({
  id: tipNodeId,
  fx: tipX,
  fy: tipY,
  radialIndex: index,
  size: 0.01, // Essentially invisible
  color: 'rgba(0,0,0,0)' // Fully transparent
});
links.push({
  source: lastNodeId,
  target: tipNodeId,
  radialIndex: index
});


const gData = { nodes, links };
const Graph = ForceGraph()(document.getElementById('graph'))
.graphData(gData)
.enableNodeDrag(false)
.linkDirectionalParticles(0)
.linkWidth(() => 0.5)
.linkColor(() => '#000000')
.nodeCanvasObject((node, ctx, globalScale) => {
  if (node.id === centerNodeId) {
    // Draw concentric rings around center
    ctx.save();
    ctx.translate(node.x, node.y); // Needed to draw arcs at the center node's position
    ctx.strokeStyle = '#ddd';
    ctx.lineWidth = 1;
    for (let i = 0; i < maxLayers; i++) {
      ctx.beginPath();
      ctx.arc(0, 0, baseRadius + i * ringSpacing, 0, 2 * Math.PI);
      ctx.stroke();
    }
    ctx.restore();
  } else {
    // Draw normal node
    const size = node.size || 4;
    ctx.beginPath();
    ctx.arc(node.x, node.y, size, 0, 2 * Math.PI, false);
    ctx.fillStyle = node.color || '#666';
    ctx.fill();
  }
});

    // Filters UI
const allCategories = [...new Set(entities.flatMap(e => e.categories))];
const allImpacts = [...new Set(entities.flatMap(e => e.impacts))];

function createCheckbox(filterType, value) {
  const label = document.createElement('label');
  label.style.display = 'block';
  const checkbox = document.createElement('input');
  checkbox.type = 'checkbox';
  checkbox.value = value;
  checkbox.name = filterType;
  checkbox.onchange = applyFilters;
  label.appendChild(checkbox);
  label.appendChild(document.createTextNode(' ' + value));
  return label;
}

const categoryDiv = document.getElementById('categoryFilters');
allCategories.forEach(cat => categoryDiv.appendChild(createCheckbox('category', cat)));

const impactDiv = document.getElementById('impactFilters');
allImpacts.forEach(imp => impactDiv.appendChild(createCheckbox('impact', imp)));

function getCheckedFilters(name) {
  return [...document.querySelectorAll(`input[name="${name}"]:checked`)].map(cb => cb.value);
}

function applyFilters() {
  const selectedCategories = getCheckedFilters('category');
  const selectedImpacts = getCheckedFilters('impact');

  const radialToInclude = new Set();

  nodes.forEach(n => {
    if (!n.name) return;
    const catMatch = selectedCategories.length === 0 || selectedCategories.some(cat => n.categories.includes(cat));
    const impMatch = selectedImpacts.length === 0 || selectedImpacts.includes(n.impact);
    if (catMatch && impMatch) {
      radialToInclude.add(n.radialIndex);
    }
  });

  const filteredNodes = nodes.filter(n =>
    n.id === centerNodeId || (n.radialIndex !== undefined && radialToInclude.has(n.radialIndex))
    );

  const nodeMap = new Map(filteredNodes.map(n => [n.id, n]));

  const filteredLinks = links
  .filter(link => nodeMap.has(link.source.id ?? link.source) && nodeMap.has(link.target.id ?? link.target))
  .map(link => ({
    source: nodeMap.get(link.source.id ?? link.source),
    target: nodeMap.get(link.target.id ?? link.target),
    radialIndex: link.radialIndex
  }));

  Graph.graphData({ nodes: filteredNodes, links: filteredLinks });
}
</script>
</body>
</html>
